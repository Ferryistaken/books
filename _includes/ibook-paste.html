<textarea id="ibook-text" rows="10" cols="50" placeholder="Paste iBook highlights here"></textarea><br>
<button class="button-style" role="button" onclick="convertToCSV()">Convert to CSV</button>


<script>
    function convertToCSV() {
    const text = document.getElementById('ibook-text').value;
    if (!text) {
        alert('Please paste the iBook text into the textarea.');
        return;
    }

    const blocks = text.split(/\n\s*\n/);
    const highlights = blocks.map(block => {
        if (block.startsWith('Excerpt from:')) {
            return block.split('\n').slice(4).join(' ').trim();
        } else {
            return block.trim();
        }
    }).filter(highlight => highlight);

    const csvContent = highlights.map(highlight => `"${highlight.replace(/"/g, '""')}"`).join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.setAttribute('download', 'ibook_highlights.csv');
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>
